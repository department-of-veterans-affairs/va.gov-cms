version: '3.6'

services:
  datadog:
    container_name: ddev-${DDEV_SITENAME}-datadog
    image: datadog/agent:latest
    restart: "no"
    labels:
      com.ddev.site-name: ${DDEV_SITENAME}
    environment:
      - DD_ENV=local
      - DD_SERVICE=vagov-cms
      - DD_API_KEY=6f768ca9a9b3b51e5ef6e23ecfaa3693
      - DD_TAGS=user:olivereri
      - DD_LOGS_ENABLED=false
      - DD_AGENT_HOST=datadog
      - DD_TRACE_CLI_ENABLED=true
      - DD_PROFILING_ENABLED=true
    volumes:
      - ".:/mnt/ddev_config"
      - "./datadog/mcache.conf.yaml:/etc/datadog-agent/conf.d/mcache.d/conf.yaml"
      - "./datadog/mysql.conf.yaml:/etc/datadog-agent/conf.d/mysql.d/conf.yaml"
    links:
      - web:web
      - db:db
      - memcached:memcached
  web:
    environment:
      - DD_ENV=local
      - DD_SERVICE=vagov-cms
      - DD_SERVICE_MAPPING=pdo:vagov-cms-pdo
      - DD_PROFILING_ENABLED=true
      - DD_TRACE_CLI_ENABLED=true
