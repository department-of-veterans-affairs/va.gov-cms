{
    "name": "va-gov/cms",
    "description": "The CMS for VA.gov",
    "type": "project",
    "license": "GPL-2.0+",
    "minimum-stability": "dev",
    "prefer-stable": true,
    "require-dev": {
        "drupal/media_entity_generic": "^1.0",
        "acquia/drupal-spec-tool": "^2.0"
    },
    "require": {
        "alchemy/zippy": "^0.4.9",
        "bower-asset/blazy": "^1.8",
        "bower-asset/cropper": "^4.1",
        "bower-asset/dropzone": "^5.5",
        "cweagans/composer-patches": "^1.6.4",
        "devshop/behat-drupal-extension": "dev-rewrite-last-page-output-links",
        "drupal-composer/drupal-scaffold": "^2.0.0",
        "drupal/address": "^1.4",
        "drupal/admin_toolbar": "^1.24",
        "drupal/auto_entitylabel": "^2.1@beta",
        "drupal/better_field_descriptions": "^1.4",
        "drupal/blazy": "^2.0@RC",
        "drupal/block_content_permissions": "^1.6",
        "drupal/block_visibility_groups": "^1.3",
        "drupal/cer": "^4.0@alpha",
        "drupal/coder": "^8.3",
        "drupal/components": "^1.0",
        "drupal/computed_field": "^2.0",
        "drupal/config_ignore": "^2.1",
        "drupal/config_override_warn": "^1.0",
        "drupal/config_split": "^1.4",
        "drupal/content_lock": "^2.0@alpha",
        "drupal/core": "^8.8.6",
        "drupal/crop": "^2.0",
        "drupal/cshs": "^1.0@beta",
        "drupal/ctools_block": "^3.2",
        "drupal/devel": "^2.1",
        "drupal/dropzonejs": "^2.0",
        "drupal/dynamic_entity_reference": "^2.0",
        "drupal/embed": "^1.3",
        "drupal/entity_block": "^1.0@beta",
        "drupal/entity_browser": "^2.4",
        "drupal/entity_clone": "^1.0@beta",
        "drupal/entity_embed": "^1.0",
        "drupal/entity_reference_revisions": "^1.7",
        "drupal/entity_reference_unpublished": "^1.1",
        "drupal/entityqueue": "^1.0@beta",
        "drupal/environment_indicator": "^3.5",
        "drupal/fast_404": "^1.0@alpha",
        "drupal/feature_toggle": "^1.2",
        "drupal/field_group": "dev-3.x#b245b85f99c48221edf5fb60344dfe53737ae0f9",
        "drupal/fieldhelptext": "^1.0@beta",
        "drupal/govdelivery_bulletins": "^1.2",
        "drupal/graphql": "^3.0",
        "drupal/graphql_metatag": "1.x-dev",
        "drupal/health_check_url": "^2.1",
        "drupal/ief_table_view_mode": "^2.1",
        "drupal/image_style_warmer": "^1.0@beta",
        "drupal/image_widget_crop": "^2.2",
        "drupal/kint": "^2.1",
        "drupal/libraries": "^3.0@alpha",
        "drupal/lightning_api": "^4.4",
        "drupal/lightning_core": "^5.0",
        "drupal/lightning_page": "^5.0",
        "drupal/lightning_roles": "^5.0",
        "drupal/lightning_search": "^5.0",
        "drupal/lightning_workflow": "^3.14",
        "drupal/linkit": "5.0.0-beta8",
        "drupal/markdown": "^1.2",
        "drupal/markup": "^1.0@beta",
        "drupal/mass_pwreset": "^1.0@alpha",
        "drupal/menu_breadcrumb": "^1.8",
        "drupal/menu_export": "^1.2",
        "drupal/menu_item_extras": "^2.7",
        "drupal/migrate_plus": "^4.0",
        "drupal/migrate_source_csv": "^2.2",
        "drupal/migrate_tools": "^4.0",
        "drupal/migration_tools": "^2.1",
        "drupal/module_missing_message_fixer": "^1.1",
        "drupal/node_link_report": "^1.14",
        "drupal/node_revisions_autoclean": "^1.0@beta",
        "drupal/node_title_help_text": "^1.0",
        "drupal/override_node_options": "^2.4",
        "drupal/paragraphs": "^1.5",
        "drupal/paragraphs_browser": "^1.0@alpha",
        "drupal/password_policy": "^3.0@alpha",
        "drupal/password_strength": "^2.0@alpha",
        "drupal/path_redirect_import": "^1.0@beta",
        "drupal/pathauto": "^1.6",
        "drupal/pathologic": "^1.0@alpha",
        "drupal/pfm": "^1.1",
        "drupal/post_api": "^2.0.1",
        "drupal/redirect": "^1.3",
        "drupal/redirect_options": "^1.2",
        "drupal/rest_menu_tree": "^1.1",
        "drupal/restui": "^1.16",
        "drupal/role_delegation": "^1.0@alpha",
        "drupal/seckit": "^1.1",
        "drupal/simplesamlphp_auth": "^3.0",
        "drupal/site_alert": "1.x-dev#d3700174bdddeca1f33c6995fde86e436b034270",
        "drupal/slack": "^1.2",
        "drupal/social_media_links": "^2.6",
        "drupal/tablefield": "^2.1",
        "drupal/taxonomy_menu": "^3.4",
        "drupal/textfield_counter": "^1.6",
        "drupal/tome": "1.3",
        "drupal/toolbar_menu": "^2.1",
        "drupal/toolbar_menu_clean": "^1.0",
        "drupal/tour_ui": "^1.0@beta",
        "drupal/ui_patterns": "^1.0",
        "drupal/user_history": "^1.0@alpha",
        "drupal/uswds": "^1.0@beta",
        "drupal/video_embed_media": "^2.2",
        "drupal/views_bulk_edit": "^2.3",
        "drupal/views_bulk_operations": "^2.5",
        "drupal/views_data_export": "^1.0@beta",
        "drupal/views_infinite_scroll": "^1.6",
        "drupal/views_tree": "^2.0@alpha",
        "drupal/webform": "^5.5",
        "drupal/workbench_access": "^1.0@beta",
        "drupal/workbench_menu_access": "^1.0",
        "drush-ops/behat-drush-endpoint": "^0.0.4",
        "drush/drush": "~8",
        "guzzlehttp/guzzle": "^6.0@dev",
        "michelf/php-markdown": "^1.8",
        "mouf/nodejs-installer": "^1.0",
        "npm-asset/yarn": "1.12.3",
        "phpunit/phpunit": "^6",
        "provision-ops/yaml-tests": "~1.9",
        "querypath/querypath": "^3.0",
        "simplesamlphp/simplesamlphp": "^1.17",
        "squizlabs/php_codesniffer": "^3.5",
        "symfony/config": "^3.4",
        "symfony/finder": "^3",
        "symfony/phpunit-bridge": "^4.3",
        "twig/twig": "^1.38.2",
        "va-gov/web": "dev-master",
        "webflo/drupal-finder": "^1.0.0",
        "webmozart/path-util": "^2.3",
        "weitzman/drupal-test-traits": "dev-master",
        "zaporylie/composer-drupal-optimizations": "^1.0"
    },
    "autoload": {
        "psr-4": {
            "Traits\\": "tests/traits",
            "CustomDrupal\\": "tests/behat/Drupal"
        },
        "files": [
            "scripts/composer/EnvironmentHandler.php"
        ]
    },
    "repositories": {
        "drupal": {
            "type": "composer",
            "url": "https://packages.drupal.org/8"
        },
        "assets": {
            "type": "composer",
            "url": "https://asset-packagist.org"
        },
        "dev": {
            "type": "github",
            "url": "https://github.com/acquia/lightning-dev",
            "no-api": true
        }
    },
    "config": {
        "discard-changes": true,
        "process-timeout": 0,
        "bin-dir": "bin",
        "vendor-dir": "docroot/vendor",
        "sort-packages": true,
        "platform": {
            "php": "7.1.3"
        },
        "preferred-install": {
            "drupal/core": "source"
        }
    },
    "extra": {
        "drupal-scaffold": {
            "excludes": [
                ".htaccess"
            ]
        },
        "mouf": {
            "nodejs": {
                "version": "10.15.3",
                "targetDir": "vendor/nodejs/nodejs",
                "forceLocal": true
            }
        },
        "installer-types": [
            "bower-asset",
            "npm-asset",
            "node-project"
        ],
        "installer-paths": {
            "docroot/core": [
                "type:drupal-core"
            ],
            "docroot/libraries/{$name}": [
                "type:drupal-library",
                "type:bower-asset",
                "type:npm-asset"
            ],
            "docroot/modules/contrib/{$name}": [
                "type:drupal-module"
            ],
            "docroot/profiles/contrib/{$name}": [
                "type:drupal-profile"
            ],
            "docroot/themes/contrib/{$name}": [
                "type:drupal-theme"
            ],
            "drush/contrib/{$name}": [
                "type:drupal-drush"
            ]
        },
        "enable-patching": true,
        "composer-exit-on-patch-failure": true,
        "patches-ignore": {},
        "patches": {
            "drupal/content_lock": {
                "Content lock causes redirect response preventing migration rollback.": "https://www.drupal.org/files/issues/2018-08-28/2951652-4.patch"
            },
            "drupal/core": {
                "2807629 - Allow menu items which link to unpublished nodes to be selected in the parent item selector": "https://www.drupal.org/files/issues/drupal-core-allow-menu-items-to-link-to-unpublished-2807629-7-8.3.x.patch",
                "2893933 - claimItem in the database and memory queues does not use expire correctly": "https://www.drupal.org/files/issues/2020-01-07/2893933-34.patch",
                "3057267 - User logout during maintenance mode": "https://www.drupal.org/files/issues/2019-09-11/3057267-maintenance-forced-logout-experimental.patch"
            },
            "drupal/entity_browser": {
                "Entity display plugin Rendered Entity is missing cache tags/keys": "https://www.drupal.org/files/issues/2020-03-31/rendered-entity-cache-keys-tags-3123876-2.patch"
            },
            "drupal/entity_clone": {
                "Cloning child references to nodes has potential to cause memory resource issues": "https://www.drupal.org/files/issues/2020-02-10/entity_clone-child-node-system-drain-3112577-1.patch"
            },
            "drupal/field_group": {
                "Allow to position the group in the advanced (sidebar) column": "https://www.drupal.org/files/issues/2018-07-26/2652642-59.patch",
                "Incompatibility with inline entity form": "https://www.drupal.org/files/issues/2018-10-30/field_group-inline_entity_form_compatibility-2986704-3.patch"
            },
            "drupal/govdelivery_bulletins": {
                "Use default lease time in claimItem()": "https://www.drupal.org/files/issues/2020-04-16/default-claim-time-3128425-2.patch"
            },
            "drupal/graphql": {
                "PHP 7.4 Notices (https://github.com/drupal-graphql/graphql/pull/989)": "https://patch-diff.githubusercontent.com/raw/drupal-graphql/graphql/pull/989.patch"
            },
            "drupal/inline_entity_form": {
                "Collapsed by default complex widget closes when trying to edit reference.": "https://www.drupal.org/files/issues/2018-11-08/2994001-open-on-action.patch"
            },
            "drupal/ics_field": {
                "Include end date / time in ICS file.": "https://www.drupal.org/files/issues/2018-10-06/ics_field-2852239-11.patch"
            },
            "drupal/linkit": {
                "Adds field level linkit functionality.": "https://www.drupal.org/files/issues/2019-07-25/linkit_modified_patch-118-123.patch",
                "Fix broken autocomplete.js loading.": "https://www.drupal.org/files/issues/2018-07-19/linkit_autocomplete_not_loaded-2973181-4.patch"
            },
            "drupal/menu_link_content": {
                "Fix php warning when creating new items": "https://www.drupal.org/files/issues/updateLink-2775665-2.patch"
            },
            "drupal/paragraphs_browser": {
                "#3057621: Notice: Undefined index: paragraph_type_title": "https://www.drupal.org/files/issues/2019-07-18/undefined-index-paragraph_type_title-trait-3057621-7.patch",
                "Local version of https://www.drupal.org/project/paragraphs_browser/issues/3116501 to apply correctly": "./patches/paragraphs_browser/remove-paragraph-group-3116501-2.patch"
            },
            "drupal/path_redirect_import": {
                "Add an option to import non-existent paths": "https://www.drupal.org/files/issues/2019-09-17/path_redirect_import-2995543-4.patch"
            },
            "drupal/hide_revision_field": {
                "Fix whitescreen when editing your own user. https://www.drupal.org/project/hide_revision_field/issues/3018160": "https://www.drupal.org/files/issues/2019-05-15/hide-revision-field-3018160-5-8.x-2.1.patch"
            },
            "drupal/schemata": {
                "PHP 7.2 notice - \"Undefined offset: 1\" in JsonSchemaEncoder": "https://www.drupal.org/files/issues/2019-07-08/3063027-5-undefined-offset.patch"
            },
            "drupal/simplesamlphp_auth": {
                "Don't attempt username sync when user was already matched by username": "https://www.drupal.org/files/issues/2019-08-14/2748731-23.patch",
                "Bypass password requirement for password change if logged in with sso.": "https://www.drupal.org/files/issues/2018-05-01/simplesamlphp_auth-change-password-access-2968598-2.patch"
            },
            "drupal/site_alert": {
                "Add drush commands https://www.drupal.org/project/site_alert/issues/3118800": "https://www.drupal.org/files/issues/2020-05-20/site_alert-add_drush_commands-3118800-12.patch",
                "Make drush commands Drush 8 https://www.drupal.org/project/site_alert/issues/3118800": "https://www.drupal.org/files/issues/2020-05-20/site_alert-add_drush_commands_for_drush8-3118800-14.patch",
                "Allow access to /ajax/site_alert route in maintenance mode": "https://www.drupal.org/files/issues/2020-04-29/maintenance-access.patch"
            },
            "drupal/tablefield": {
                "0 string value in cell throws empty error": "https://www.drupal.org/files/issues/2019-12-10/0-value-throwing-empty-error.patch"
            },
            "drupal/textfield_counter": {
                "Prevent form submission when character limit exceeded option does not work": "https://www.drupal.org/files/issues/2018-10-04/textfield_counter-prevent_form_submission_does_not_work-3004457-2.patch"
            },
            "drupal/tome":{
                "Allow entity types to be excluded in tome sync":"https://www.drupal.org/files/issues/2020-02-20/tome_export_types-3114961-2.patch"
            },
            "drupal/user_history": {
                "Invalid argument in foreach when saving a user": "https://www.drupal.org/files/issues/2019-12-11/invalid-argument-on-save_0.patch"
            },
            "drupal/workflow_participants": {
                "Fix revision uncaught type error by extending class.": "https://www.drupal.org/files/issues/2019-08-16/workflow_participants-revision-error-3075426-1.patch"
            }
        }
    },
    "scripts": {
        "set-path": [
            "# Run the command output below to set your current terminal PATH variable.",
            "# This will allow you to run any command in the ./bin directory without a path.",
            "echo \"export PATH=${PATH}\""
        ],
        "post-install-cmd": [
            "DrupalComposer\\DrupalScaffold\\Plugin::scaffold",
            "mkdir --parents docroot/profiles",
            "cp -r 'hooks/git/.' '.git/hooks/'",
            "php -r \"chmod('.git/hooks/pre-commit', 0777);\"",
            "cp -r 'simplesamlphp-1.17.2/config/' 'docroot/vendor/simplesamlphp/simplesamlphp/'",
            "cp -r 'simplesamlphp-1.17.2/metadata/' 'docroot/vendor/simplesamlphp/simplesamlphp/'",
            "echo 'Removing deleted .git/hooks/commit-msg file, no longer used.'",
            "rm -f .git/hooks/commit-msg",
            "git update-index --skip-worktree samlsessiondb.sq3",
            "@va:web:install"
        ],
        "post-update-cmd": [
            "DrupalComposer\\DrupalScaffold\\Plugin::scaffold",
            "cp -r 'hooks/git/.' '.git/hooks/'",
            "php -r \"chmod('.git/hooks/pre-commit', 0777);\""
        ],
        "nuke": [
            "rm -rf bin node_modules docroot/libraries docroot/core docroot/modules/contrib docroot/themes/contrib docroot/profiles/contrib/ docroot/vendor /var/www/.cache/yarn",
            "composer clear-cache"
        ],
        "va:start": [
            "@composer install --ansi",
            "@va:install",
            "# To setup default content, run: `drupal module:install va_gov_content`",
            "# cms.VA.gov installed: Username: admin  Password: admin",
            "@va:server"
        ],
        "va:server": [
            "drupal server localhost:9000 --ansi "
        ],
        "va:install": [
            "drush site:install va_gov --yes --account-name admin --account-pass admin --ansi --site-name='Veterans Affairs'"
        ],
        "va:reinstall": [
            "# This only reinstalls sites installed with SQLite...",
            "chmod +w -R docroot/sites/default",
            "rm -rf docroot/sites/default/files",
            "@va:start"
        ],
        "va:config:export": [
            "drupal config:export --ansi"
        ],
        "va:config:import": [
            "drupal config:import --ansi"
        ],
        "va:database:download": [
            "cd .dumps && curl --remote-name --remote-header-name https://dsva-vagov-prod-cms-backup-sanitized.s3-us-gov-west-1.amazonaws.com/database/cms-prod-db-sanitized-latest.sql.gz && gunzip --force cms-prod-db-sanitized-latest.sql.gz && echo 'SQL dump saved to .dumps/cms-db-latest.sql'"
        ],
        "va:proxy:socks": [
            "ssh socks -D 2001 -N"
        ],
        "va:proxy:test": [
            "curl -v --proxy socks5h://127.0.0.1:2001 sentry.vetsgov-internal"
        ],
        "va:proxy:sshuttle": [
            "sudo -E sshuttle -r dsva@52.222.32.121 -e 'ssh -A ' 10.0.0.0/8"
        ],
        "va:test:accessibility": [
            "npm install --only=production",
            "npm test"
        ],
        "va:test:lint": [
            "find docroot/modules/custom docroot/themes -name '*.php' -print0 | xargs -0 -n1 php -l > /dev/null",
            "find docroot/modules/custom docroot/themes -name '*.module' -print0 | xargs -0 -n1 php -l > /dev/null",
            "find docroot/modules/custom docroot/themes -name '*.install' -print0 | xargs -0 -n1 php -l > /dev/null"
        ],
        "va:test:cs": [
            "phpcs --ignore=*.md,*.min.css,styles.css,wysiwyg.css,*/node_modules/*,*/simplesaml*/* --standard=./docroot/vendor/drupal/coder/coder_sniffer/Drupal/ruleset.xml docroot/modules/custom docroot/themes/custom --colors"
        ],
        "va:test:unit": "phpunit tests/phpunit --colors=always --exclude-group=disabled",
        "va:cbf": "phpcbf --ignore=*.md,*.min.css,uswds.css,*/node_modules/*,*/simplesaml*/* --standard=./docroot/vendor/drupal/coder/coder_sniffer/Drupal/ruleset.xml docroot/modules/custom docroot/themes/custom --colors",
        "va:web:install": [
            "# Preparing Front-end...",
            "cd bin && ln -sf ../docroot/libraries/yarn/bin/yarn yarn",
            "node -v",
            "npm -v",
            "yarn -v",
            "cd web && yarn run install-repos",
            "export NODE_EXTRA_CA_CERTS=/etc/pki/tls/certs/ca-bundle.crt PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=TRUE; cd web && yarn install"
        ],
        "va:web:server": [
            "cd web && yarn build"
        ],
        "va:web:watch": [
            "cd web && npm run watch"
        ],
        "va:web:start": [
            "@va:web:install",
            "@va:web:watch"
        ],
        "va:web:build": [
            "drush config-set va_gov.build web.build.pending 1 -y",
            "rm -rf docroot/vendor/va-gov/web/build/vagovdev",
            "echo \"Downloading assets for vets-website ref $(git rev-parse --verify HEAD)\" ",
            "cd web && NODE_ENV=production yarn build:content --pull-drupal --no-drupal-proxy --buildtype=vagovdev --api=https://dev-api.va.gov --asset-source=$(git rev-parse --verify HEAD)",
            "echo 'Replace s3 address with local in generated files'",
            "find ./docroot/vendor/va-gov/web/build/vagovdev/generated -type f -print0 | xargs -0 sed -i \"s/https:\\/\\/dev-va-gov-assets\\.s3-us-gov-west-1\\.amazonaws\\.com//g\" ",
            "drush config-set va_gov.build web.build.pending 0 -y"
        ],
        "va:web:test": [
            "echo 'drupal address: ' $DRUPAL_ADDRESS"
        ]
    }
}
