# Upstream Dependencies

## Background

This document lists known external dependencies for the CMS.
Official points of contact for each service are listed.
Other points of contact for some services are listed on [DSVA Slack](https://dsva.slack.com/archives/CT4GZBM8F/p1628284192216100).

## Runtime
| Service                                                                                                                      | Content                                                                                                                                                                               | Mode                                                                                                                                                                                                                                                                | Monitoring                                                                     | Escalation Contact                                                                                                                                                                                                                      | Notes                                                                                                                                                                                                                                                                                                                                             |
|------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [GovDelivery](https://granicus.com/solution/govdelivery/)                                                                    | Situation updates & alerts are sent to subscribed users via GovDelivery                                                                                                               | Uses [govdelivery_bulletins](https://github.com/department-of-veterans-affairs/va.gov-cms/tree/main/docroot/modules/custom/va_gov_govdelivery) module to post data to the GovDelivery API endpoint                                                                | [See Below](#govdelivery)                                           | [https://support.granicus.com/s/contactsupport](https://support.granicus.com/s/contactsupport)                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                   |
| Facility Status (Team Sites)                                                                                                 | [Facility operational status & additional information](https://github.com/department-of-veterans-affairs/va.gov-cms/blob/main/READMES/migrations-facility.md#vamc-status-migration) | Periodic migration pulls data from TSV endpoints on teamsite ([task](https://github.com/department-of-veterans-affairs/va.gov-cms/blob/main/tasks-periodic.yml#L98), [config](/config/sync/migrate_plus.migration.va_node_health_care_local_facility_status.yml)) | [Error Log](https://vaww.webops.va.gov/apps/errorlog/) (must be on VA network) | Teamsites is hosted on [EWIS](https://github.com/department-of-veterans-affairs/devops/blob/master/docs/External%20Service%20Integrations/EWIS.md). See also: [DSVA Slack](https://dsva.slack.com/archives/CT4GZBM8F/p1628284192216100) | This is intended to be phased out by the end of 2021 when VAMC migration is complete                                                                                                                                                                                                                                                              |
| Facility, cemetery, and health services (via Lighthouse API)                                                                 | [See Below](#facility-cemetery-and-health-services-via-lighthouse-api)                                                                                                                | [See Below](#facility-cemetery-and-health-services-via-lighthouse-api)                                                                                                                                                                                              | https://valighthouse.statuspage.io                                             | [#vsa-facilities slack channel](https://dsva.slack.com/archives/C0FQSS30V) - Adam Stinton                                                                                                                                               | API paths are [overridden](https://github.com/department-of-veterans-affairs/va.gov-cms/blob/main/docroot/modules/custom/va_gov_migrate/config/install/migrate_plus.migration.va_node_facility_nca.yml#L22) by [settings.php](https://github.com/department-of-veterans-affairs/va.gov-cms/blob/main/docroot/sites/default/settings.php#L146) |
| facilityForms API (nightly DB dump)                                                                                          | Form data (names, filenames, audiences, status) and creates/updates “VA Form” nodes                                                                                                   | [Nightly Migration](https://github.com/department-of-veterans-affairs/va.gov-cms/blob/main/READMES/migrations-forms.md#forms-migration)                                                                                                                           |                                                                                | #va-forms slack channel                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                                   |
| Jenkins (manual & automatically triggered content releases)                                                                  | Editors can trigger a content release either manually or by editing certain content types                                                                                             | [Calls jenkins webhook](https://github.com/department-of-veterans-affairs/va.gov-cms/blob/main/READMES/cms-content-release.md#automatic)                                                                                                                          | [http://jenkins.vfs.va.gov/computer/](http://jenkins.vfs.va.gov/computer/)     | Ops team (use #vfs-platform-support)                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                   |
| Slack (notifications)                                                                                                        | Post API failure alerts, Teamsite facility status failure alerts                                                                                                                      | Drupal calls Slack webhook                                                                                                                                                                                                                                          | [https://status.slack.com/](https://status.slack.com/)                         |                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                   |
| [SSOi](https://dvagov.sharepoint.com/sites/OITEPMOIAM/playbooks/Pages/IAM%20URLs.aspx) (must be on VA network to access doc) | CMS users are authenticated with the VA Single Sign On service (SSOi)                                                                                                                 | See [README](https://github.com/department-of-veterans-affairs/va.gov-cms/blob/main/READMES/cms-login.md#technical-details)                                                                                                                                       | https://iamportal.iam.va.gov/iamv2/index.php (must be on VA network)           | https://iamportal.iam.va.gov/iamv2/help/contactUs.php (must be on VA network)                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                   |
| [Unbound DNS](https://vfs.atlassian.net/wiki/spaces/OT/pages/1474594384/Unbound) | Forwards (and caches) DNS requests from TIC to AWS Route 53 DNS servers | Facilitates access to internal services from within network, e.g. CAG access to CMS | [Datadog](https://app.datadoghq.com/synthetics/details/2va-b5r-txu?live=1h) synthetic | Ops team (use #vfs-platform-support) | |
### GovDelivery

**Monitoring**

* Alerting
   * Slack notifications via Sentry from Drupal errors.
* Error logs
   * `/admin/reports/dblog?type%5B%5D=govdelivery_bulletins` (ephemeral)
   * https://sentry.vfs.va.gov/organizations/vsp/issues/?query=logger%3Agovdelivery_bulletins
* Internal
   * (pending) https://github.com/department-of-veterans-affairs/va.gov-cms/issues/6189
* External
   * [https://status.granicus.com/](https://status.granicus.com/)

The following services can affect the CMS's functionality or data at any time.

### Facility, cemetery, and health services (via Lighthouse API)

#### Content

Operating hours, Contact information, names for all facilities (VHA facilities, vet centers, cemeteries, business offices)

* [README](https://github.com/department-of-veterans-affairs/va.gov-cms/blob/main/READMES/migrations-facility.md)
* VAMC & Vet Center Facility statuses
* Cemetery statuses
* Facility health services (covid only now, all services soon)

#### Mode

* Nightly migration pulls data from the Lighthouse API from the following [periodic tasks](/tasks-periodic.yml):
   * `va/background/daily/migrate/nca_facility`
   * `va/background/daily/migrate/vba_facility`
   * `va/background/daily/migrate/vet_centers_facility`
   * `va/background/daily/migrate/health_care_local_facility`
   
* Migration configs:
   * [migrate_plus.migration.va_node_facility_nca.yml](/config/sync/migrate_plus.migration.va_node_facility_nca.yml)
   * [migrate_plus.migration.va_node_facility_vba.yml](/config/sync/migrate_plus.migration.va_node_facility_vba.yml)
   * [migrate_plus.migration.va_node_facility_vet_centers.yml](/config/sync/migrate_plus.migration.va_node_facility_vet_centers.yml)
   * [migrate_plus.migration.va_node_facility_vet_centers_mvc.yml](/config/sync/migrate_plus.migration.va_node_facility_vet_centers_mvc.yml)
   * [migrate_plus.migration.va_node_facility_vet_centers_os.yml](/config/sync/migrate_plus.migration.va_node_facility_vet_centers_os.yml)
   * [migrate_plus.migration.va_node_health_care_local_facility.yml](/config/sync/migrate_plus.migration.va_node_health_care_local_facility.yml)


## Build time

The following services can affect the deployment process' ability to fully build the CMS for testing or production deployment.

| Service                                 | Url                 | Status                                                         | Escalation                                                                                                                                                                                     | Notes                                                                                                                                                                                                 |
|-----------------------------------------|---------------------|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [Remi Repo](https://rpms.remirepo.net/) | rpms.remirepo.net   | none                                                           | Tweet [@RemiRepository](https://twitter.com/RemiRepository) and open issue at [https://forum.remirepo.net/](https://forum.remirepo.net/)                                                       | Remi Repo is used to pull in the PHP 7.3 libraries and dependencies in our AMI builds. This won't be used when we switch from Amazon Linux 1 to Amazon Linux 2 when we move to containers on ArgoKube |
| Drupal packages                         | packages.drupal.org | [@drupal_infra on Twitter](https://twitter.com/drupal_infra)   |                                                                                                                                                                                                | Drupal packages is used to download Drupal contrib modules                                                                                                                                            |
| [Packagist](https://packagist.org)      |                     | [https://status.packagist.org/](https://status.packagist.org/) | Tweet at [@packagist](https://twitter.com/packagist). It is used by thousands of sites so highly likely that someone knows about any issues before we do and that it will be resolved quickly. | Packagist is used to install our PHP dependencies that are required by Drupal custom and contrib modules.                                                                                             |
| [Github](https://github.com)            |                     | [https://www.githubstatus.com/](https://www.githubstatus.com/) | Use the #github_information channel in DSVA slack                                                                                                                                              | The codebase is stored in github, and the deployment process depends on it to pull code and push status and code quality messages to our pull requests.                                               |
| [ZenHub](https://www.zenhub.com)        |                     | https://twitter.com/zenhubstatus                               |                                                                                                                                                                                                | ZenHub is a project management layer on top of GitHub Issues that we use.                                                                                                                             |
| [Docker Hub](https://hub.docker.com/)   |                     | [https://status.docker.com/](https://status.docker.com/)       | Contact support@docker.com and/or tweet [@Docker](https://twitter.com/Docker)                                                                                                                  | We use Docker Hub to pull down container images for our CI environments in Tugboat.                                                                                                                   |
