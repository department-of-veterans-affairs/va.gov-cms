# If any of these test names get updated they need to be updated here too
# https://github.com/department-of-veterans-affairs/va.gov-cms/settings/branches

version: '3'

env:
  PATH: "/var/lib/tugboat/bin:~/.local/bin:{{.PATH}}"

dotenv: ['.env']

tasks:
  default:
    cmds:
      - task: va/tests/phplint
      - task: va/tests/phpunit
      - task: va/tests/accessibility
      - task: va/tests/behavioral
      - task: va/web/build
      - task: va/tests/behat
      - task: va/tests/revision-log
      - task: va/tests/check-cer
      - task: va/tests/status-error

  va/tests:
    desc:
    cmds:
      - task: va/tests/phplint
      - task: va/tests/phpunit
      - task: va/tests/accessibility
      - task: va/tests/behavioral
      - task: va/tests/behat
      - task: va/tests/revision-log
      - task: va/tests/check-cer
      - task: va/tests/status-error

  va/tests/phplint:
    desc: PHP Lint
    cmds:
      - composer va:test:lint

  va/tests/phpunit:
    desc: PHPUnit
    cmds:
      - echo $PATH
      - phpunit --exclude-group disabled tests/phpunit --colors=always

  va/tests/accessibility:
    desc: accessibility test with cypress-axe for 508 compliance
    cmds:
      - composer va:test:accessibility

  va/tests/behavioral:
    desc: behavioral tests with cypress
    cmds:
      - composer va:test:behavioral

  va/web/build:
    desc: Build VA.gov Front-end
    cmds:
      - ./tests/scripts/build-web.sh

  va/tests/behat:
    desc: Behat Tests
    cmds:
      - cd tests/behat
      - behat --colors

  va/tests/revision-log:
    desc: Ensure revision log field is present
    cmds:
      - ./tests/scripts/check-revision-logs.sh

  va/tests/check-cer:
    desc: Ensure cer fields exist
    cmds:
      - ./tests/scripts/check-cer.sh

  va/tests/status-error:
    desc: Check for Drupal status errors
    cmds:
      - "drush $DRUSH_ALIAS core-requirements --format=list --severity=2 | grep . && exit 1 || echo 'Success: No Drupal status requirement errors were found.'"
